#! wsl /home/giji/.rvm/wrappers/default/ruby

require_relative '../../lib/file'

COMPLETE = 0
EMPTY = 1
LINK = 2

crawle('node_modules', [
  'www/*/*',
  'www/*',
]) do |dest, src|
  if File.symlink?(dest) && File.directory?(src)
    if 0 < Dir.glob("#{src}/*").size
      COMPLETE
    else
      EMPTY
    end
  else
    LINK
  end

end.each do |mode, dest, src|
  case mode
  when COMPLETE
    size = Dir.glob("#{src}/*").size
    comment " #{ dest } #{ size }"

  when EMPTY
    comment " empty. #{ dest }"

  when LINK
    comment " #{ dest } -> #{ src }"
    mkpath src
    rmtree dest
    symlink src, dest

  end
end
